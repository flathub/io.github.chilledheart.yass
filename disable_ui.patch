From a1584ec0fc5520c20feeba2460be85b7ba290d9c Mon Sep 17 00:00:00 2001
From: Keeyou <keeyou-cn@outlook.com>
Date: Thu, 22 Aug 2024 17:13:10 +0800
Subject: [PATCH] cmake: add flathub build option

---
 CMakeLists.txt          | 7 +++++++
 src/qt6/yass_window.cpp | 5 +++++
 2 files changed, 12 insertions(+)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 55b8b145..4dfdba3f 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -536,6 +536,13 @@ cmake_dependent_option(
   INSTALL_FLATHUB_METAINFO "Build with flathub metainfo" OFF
   "GUI AND LINUX" OFF)
 
+option(FLATHUB_BUILD "Build with flathub build" OFF)
+
+if (FLATHUB_BUILD)
+  list(APPEND YASS_APP_FEATURES "flathub-build")
+  add_definitions(-DFLATHUB_BUILD)
+endif()
+
 # Dynamic users are supported from version 235
 # see https://0pointer.net/blog/dynamic-users-with-systemd.html
 if (USE_OLD_SYSTEMD_SERVICE)
diff --git a/src/qt6/yass_window.cpp b/src/qt6/yass_window.cpp
index b5b1e881..dcfbd924 100644
--- a/src/qt6/yass_window.cpp
+++ b/src/qt6/yass_window.cpp
@@ -147,10 +147,15 @@ YASSWindow::YASSWindow(QWidget* parent) : QMainWindow(parent) {
 
   autostart_ = new QCheckBox;
   systemproxy_ = new QCheckBox;
+#ifdef FLATHUB_BUILD
+  autostart_->setEnabled(false);
+  systemproxy_->setEnabled(false);
+#else
   autostart_->setChecked(Utils::GetAutoStart());
   systemproxy_->setChecked(Utils::GetSystemProxy());
   connect(autostart_, &QPushButton::clicked, this, &YASSWindow::OnAutoStartClicked);
   connect(systemproxy_, &QPushButton::clicked, this, &YASSWindow::OnSystemProxyClicked);
+#endif
 
   grid->addWidget(server_host_, 0, 2);
   grid->addWidget(server_sni_, 1, 2);
-- 
2.45.2

